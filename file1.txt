updated feature. very complicated stuff